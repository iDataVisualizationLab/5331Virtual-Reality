<!DOCTYPE html>
<meta charset="utf-8">
<style> /* set the CSS */

body { font: 15px Arial;}

path { 
    fill: none;
}
.axis path,
.axis line {
    fill: none;
    stroke: grey;
    stroke-width: 1;
    shape-rendering: crispEdges;
}
#controlHolder {
  position:absolute;
  z-index: 0;
  top: 165px;
  left: 127px;
  border: 0px solid rgba(0,0,0, 1);
  background-color: none;
}

#searchHolder {
  position:absolute;
  z-index: 0;
  top: 65px;
  left: 427px;
  border: 0px solid rgba(0,0,0, 1);
  background-color: none;
}
</style>
<body bgcolor="white" text="black" id="mainBody">
<svg width="2000" height="800"></svg>

<div id="searchHolder"  class="searchHolder">
  <input id="search">
  <button type="button" onclick="searchNode()">Search</button>
  <progress value="0" max="100" id="progBar">
      <span id="downloadProgress">
          <!-- Your fallback goes here -->
      </span>
  </progress>
  <label id="progUpdate">
      <!-- Success Message -->
  </label>
</div> 

<div id="controlHolder"  class="controlHolder">
 <input type="checkbox" id="checkboxP1" visibility="hidden" value="value2" class="check" onclick="showP1()">
<label for="checkboxP1"> Project results</label> 
</div> 

<!-- load the d3.js library -->    
<script src="jquery.min.js"></script>
<script type='text/javascript' src="jquery-ui.min.js"> </script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<link href="jquery-ui.css" rel="stylesheet" type="text/css" />

<script>

// Set the dimensions of the canvas / graph
var margin = {top: 5, right: 30, bottom: 50, left: 70};
var revealIdentity = false;
var aData = [];
 
var svg = d3.select("svg"),
    width = +document.getElementById("mainBody").offsetWidth-margin.left-margin.right,
    height = +svg.attr("height")-margin.top-margin.bottom;

svg = svg.append("g")
        .attr("transform", 
              "translate(" + margin.left + "," + margin.top + ")");

// Parse the date / time
var parseTime = d3.timeParse("%m/%d/%y");

// Set the ranges
var x = d3.scaleTime().range([0, width-margin.left*2]);
var xNew = d3.scaleTime().range([0, width/2-margin.left]);

var y = d3.scaleLinear().range([height, 0]);
var yAxis= d3.scaleLinear().range([height, 0]);
var yP1= d3.scaleLinear().range([height*1.7, 0]);




// Student info data  
var data2 = {};
var dataG = {};

var groupCount = [{},{},{},{}];
d3.csv("data/Students.csv", function(error, data_) {
  d3.csv("data/ResearchInsights.csv", function(error, dataG_) {
    dataG = dataG_;
    data_.forEach(function(d) {
      if (data2[d.Fullname]==undefined)
          data2[d.Fullname] = {};
      data2[d.Fullname] =d;  

    });
    main();
  })  
})

// Force-directed layout
var simulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(function(d) { return d.id; }))
    .force("link", d3.forceLink().distance(1).strength(1))
    .force("charge", d3.forceManyBody().strength(-0.1));

var color = d3.scaleOrdinal(d3.schemeCategory10);
var radius = 8;

var node, link;
var nodeP1, linkP1, link01;
var nodeP2, linkP2, link02;
var nodeImage, nodeImageP1;

var dur = 400;  // animation duration
  

// Force-directed layout
var nodes=[];
var links=[];
var nodesG=[];
var linksG=[];

var startDate = new Date("3/1/2018");
var endtDate = new Date("1/1/2020");

var today = new Date();
    
function getCategoty(str){
  if (str=="PhD")
    return 3;
  else if (str=="MSSE")
    return 2;
  else if (str=="MSCS")
    return 1;
  else 
    return 0; 
}
var data = {};



function main(){
  d3.csv("data/participation.csv", function(error, data_) {
    data_.forEach(function(d) {
      if (data[d.Students]==undefined)
          data[d.Students] = {};
      if (data[d.Students].array==undefined)
          data[d.Students].array= [];
      var object =  {}; 
      object.date = new Date(d.Date);
      object.score = +d.Scores/2;
      //object.studentTalk = +d.StudentTalk;
      data[d.Students].array.push(object);
      data[d.Students].array.name = d.Students;
      data[d.Students].array.studentTalk = +data2[d.Students].StudentTalk;
      data[d.Students].array.studentReport = +data2[d.Students].StudentReport;
      data[d.Students].array.nickname =data2[d.Students].Nickname;
      data[d.Students].array.group = getCategoty(data2[d.Students].Program);
      data[d.Students].array.image = data2[d.Students].Photoname;
      data[d.Students].array.P1_code = parseFloat(data2[d.Students].P1_code);
      data[d.Students].array.P1_talk = parseFloat(data2[d.Students].P1_talk);
      data[d.Students].array.P1_report = parseFloat(data2[d.Students].P1_report);
      data[d.Students].array.P1_survey = parseFloat(data2[d.Students].P1_survey);
      data[d.Students].array.P2_code = parseFloat(data2[d.Students].P2_code);
      data[d.Students].array.P2_talk = parseFloat(data2[d.Students].P2_talk);
      data[d.Students].array.P2_report = parseFloat(data2[d.Students].P2_report);
      data[d.Students].array.P2_review = parseFloat(data2[d.Students].P2_review);
      data[d.Students].array.P2_group_score = parseFloat(data2[d.Students].P2_group_score); 
      data[d.Students].array.P3_code = parseFloat(data2[d.Students].P3_code);
      data[d.Students].array.P3_talk = parseFloat(data2[d.Students].P3_talk);
      data[d.Students].array.P3_report = parseFloat(data2[d.Students].P3_report);
      data[d.Students].array.P3_review = parseFloat(data2[d.Students].P3_review);
      data[d.Students].array.P3_group_score = parseFloat(data2[d.Students].P3_group_score); 
      data[d.Students].array.index = data[d.Students].array.length-1;
    });
      
    // Accumulate values
    for (var key in data){
      var arr = data[key].array;
      for (var i=0; i< arr.length; i++){
        if (i>0)
          arr[i].score+=arr[i-1].score;
        arr.score= arr[i].score;  // Copy the final score to array
        arr.date = arr[i].date;
      }
    }

    // Make a new array

    for (var key in data){
      var arr = data[key].array
      aData.push(arr);
      // count group (students by program)
      if (groupCount[arr.group].count==undefined)
        groupCount[arr.group].count=0;  
      groupCount[arr.group].count++;
      groupCount[arr.group].program = data2[key].Program;
    }
     // Scale the range of the data
      x.domain([startDate,endtDate]);
      xNew.domain([startDate,endtDate]);
      y.domain([0, 15]);
      yAxis.domain([0, 0.15]);
      yP1.domain([0, 25]);


  // Search student nicknam
  var optArray =[];
  for (var student in data2) {
     optArray.push(data2[student].Nickname);
  }
  optArray = optArray.sort();
  $(function () {
      $("#search").autocomplete({
          source: optArray
      });
  });
 
  // Draw color legend *************************
    svg.append("line")
      .attr("class", "legendLine10")
      .attr("stroke", "#000")
      .attr("stroke-width", 1)
      .style("stroke-dasharray", ("3, 3"))
      .attr("x1", 200)
      .attr("y1", y(10))
      .attr("x2", x(today))
      .attr("y2", y(10));

    svg.selectAll(".legendCircle")
      .data(groupCount).enter()
      .append("circle")
      .attr("class", "legendCircle")
      .attr("stroke", function(d,i) {
        return color(i);
      })
      .attr("stroke-width", 1)
      .attr("fill", function(d,i) {
        return color(i);
      })
      .attr("cx", 60)
      .attr("cy", function(d, i){ return 30+20*i})
      .attr("r", 7)
      .on("mouseover", mouseoverLegend)
      .on("mouseout", mouseoutLegend);  
    
    svg.selectAll(".legendLine")
      .data(groupCount).enter()
      .append("line")
      .attr("class", "legendLine")
      .attr("stroke", function(d,i) {
        return color(i);
      })
      .attr("stroke-width", 1)
      .attr("fill", "#fff")
      .attr("x1", 40)
      .attr("y1", function(d, i){ return 30+20*i})
      .attr("x2", 62)
      .attr("y2", function(d, i){ return 30+20*i});

    svg.selectAll(".legendText")
      .data(groupCount).enter()
      .append("text")
      .attr("class", "legendText")
      .style("font-size", "15px")
      .attr("text-anchor", "left")
      .attr("fill", function(d,i) {return color(i); })
      .attr("x", 62+radius)
      .attr("y", function(d, i){ return 36+20*i})
      .text(function(d){
        return d.program + " ("+d.count+" students)"})
      .on("mouseover", mouseoverLegend)
      .on("mouseout", mouseoutLegend);
    
    
    // Draw title *******************************
     svg.append("text")
      .attr("class", "title")
      .style("font-size", "25px")
      .attr("text-anchor", "left")
      .attr("fill", "#000")
      .attr("x", margin.left+230)
      .attr("y", 20)
      .text("Class participation graph");
    
    // Draw Label for yAxis *******************************
     svg.append("text")
      .attr("class", "title")
      .style("font-size", "17px")
      .attr("text-anchor", "middle")
      .attr("fill", "#000")
      .attr("x", width/2-100)
      .attr("y", height+40)
      .text("Date");
    
    
      // Add the x Axis
      svg.append("g")
        .attr("class", "xAxis")
        .style("font-size", "14px")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

      // Add the y Axis
      svg.append("g")
        .style("font-size", "14px")
        .call(d3.axisLeft(yAxis).ticks(12, "%"));

      // Append xAxis label
      svg.append("text")
        .style("fill", "black")
        .style("font-size", "17px")
        .attr("dy", ".35em")
        .attr("text-anchor", "middle")
        .attr("transform", "translate(-52,"+height/2+") rotate(-90)")
        .text("Percentage of participations in student's final grade");    
////
    for (var i=0; i<dataG.length;i++){
      var nod1 = {};
        nod1.name = dataG[i].Title;
        nod1.Deadline = new Date(dataG[i].Deadline);
        nodes.push(nod1);

        var nod2 = {};
        nod2.name = dataG[i].Title;
        nod2.Deadline = new Date(dataG[i].Deadline);
        nodes.push(nod2);

        var lin = {};
        lin.source = nod1;
        lin.target = nod2;
        lin.group = nod1.group;
        links.push(lin);
      }

      link = svg.selectAll(".links")
        .data(links)
        .enter().append("line")
          .attr("class", "links")
          .attr("stroke", function(d){
            return color(d.group);
          })
          .attr("stroke-width",0.5);
         

      link01 = svg.selectAll(".links01")
        .data(links)
        .enter().append("line")
          .attr("class", "links01")
          .attr("stroke", function(d){ return color(d.group);})
          .attr("stroke-width",0.5);    

      link02 = svg.selectAll(".links02")
        .data(links)
        .enter().append("line")
          .attr("class", "links02")
          .attr("stroke", function(d){ return color(d.group);})
          .attr("stroke-width", function(d){
           // console.log(d.source.name);
            return d.source.name=="Sara Sartoli" ? 0 : 0.5;
          });   

      link03 = svg.selectAll(".links03")
        .data(links)
        .enter().append("line")
          .attr("class", "links03")
          .attr("stroke", function(d){ return color(d.group);})
          .attr("stroke-width", function(d){
           // console.log(d.source.name);
            return d.source.name=="Sara Sartoli" ? 0 : 0.5;
          });           
              
      node = svg.selectAll(".nodeCircle")
            .data(nodes)
            .enter().append("circle")
              .attr("class","nodeCircle")
              .attr("r", function(d,i) { 
                if (i%2==0)
                  return 0; 
                else
                  return radius+1;
             })
              .attr("fill", function(d,i) { 
                if (i%2==0)
                  return "#110"; 
                else
                  return color(d.group);
            })
            .on("mouseover", mouseoverNode)
            .on("mouseout", mouseoutNode)
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));     
                        
  simulation
      .nodes(nodes)
      .on("tick", ticked);
    simulation.force("link")
        .links(links);
    simulation.force("collide", d3.forceCollide(function(d,i){
      if (i%2==0)
        return 0;
      else
        return radius+1;
    }));  
    simulation.alpha(0.25);

  });
}

  function ticked() {
    for (var i=0;i<nodes.length;i=i+2){
      nodes[i].x = x(nodes[i].Deadline);       
      nodes[i].y = y(5); 
    }
    link
        .attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });
    node
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });
  }




function searchNode() {
    //searchTerm = document.getElementById('search').value;
    var obj ={};
    obj.nickname = document.getElementById('search').value;
    for (var i=0;i<nodes.length;i++){
      if (obj.nickname==nodes[i].nickname && nodes[i].index!=undefined){
        obj.index = nodes[i].index;
        obj.name = nodes[i].name;
      }  
    }
    mouseoutNode(obj);
    mouseoverNode(obj);    
}


    function mouseoverNode(d1){
      //if (d1.P1_code!=undefined && !document.getElementById("checkboxP1").checked)
      //   return; 
      svg.selectAll(".lineGraph")
        .transition().duration(dur)
        .attr("stroke-opacity", function (d2){ return d1.name==d2.name ? 1 : 0.05; });
      svg.selectAll(".nodeImage")
        .transition().duration(dur)
        .attr("stroke-opacity", function (d2){ return d1.name==d2.name ? 1 : 0.05; })
        .attr("fill-opacity", function (d2){ return d1.name==d2.name ? 1 : 0.1; });  
      if (revealIdentity){   
        svg.selectAll(".nodeImageP1")
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ 
            if (!document.getElementById("checkboxP1").checked) return 0;
            return d1.name==d2.name ? 1 : 0.05; })
          .attr("fill-opacity", function (d2){ 
            if (!document.getElementById("checkboxP1").checked) return 0;
            return d1.name==d2.name ? 1 : 0.1; });   
        svg.selectAll(".nodeCircle")  
        .transition().duration(dur)
        .attr("fill-opacity", 0);    
      } 
      else{
        //debugger;
        svg.selectAll(".nodeCircle")
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ 
          //  if (!document.getElementById("checkboxP1").checked) return 0;
            return d1.name==d2.name ? 1 : 0.05; })
          .attr("fill-opacity", function (d2){ 
          //  if (!document.getElementById("checkboxP1").checked) return 0;
            return d1.name==d2.name ? 1 : 0.1; });   
        if (document.getElementById("checkboxP1").checked){
          svg.selectAll(".nodeP1")
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ 
          //  if (!document.getElementById("checkboxP1").checked) return 0;
            return d1.name==d2.name ? 1 : 0.05; })
          .attr("fill-opacity", function (d2){ 
          //  if (!document.getElementById("checkboxP1").checked) return 0;
            return d1.name==d2.name ? 1 : 0.1; }); 

          // Project 2
          svg.selectAll(".nodeP2")
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ 
          //  if (!document.getElementById("checkboxP1").checked) return 0;
            return d1.name==d2.name ? 1 : 0.05; })
          .attr("fill-opacity", function (d2){ 
          //  if (!document.getElementById("checkboxP1").checked) return 0;
            return d1.name==d2.name ? 1 : 0.1; });     

          // Project 3
          svg.selectAll(".nodeP3")
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ 
          //  if (!document.getElementById("checkboxP1").checked) return 0;
            return d1.name==d2.name ? 1 : 0.05; })
          .attr("fill-opacity", function (d2){ 
          //  if (!document.getElementById("checkboxP1").checked) return 0;
            return d1.name==d2.name ? 1 : 0.1; });     
        }  

      } 

      svg.selectAll(".links")  
        .transition().duration(dur)
        .attr("stroke-opacity", function (d2){ return d1.name==d2.source.name ? 1 : 0.1; });
      svg.selectAll(".linksP1")  
        .transition().duration(dur)
        .attr("stroke-opacity", function (d2){ 
          if (!document.getElementById("checkboxP1").checked) return 0;
          return d1.name==d2.source.name ? 1 : 0.1; }); 
      svg.selectAll(".links01")  
        .transition().duration(dur)
        .attr("stroke-opacity", function (d2){ 
          if (!document.getElementById("checkboxP1").checked) return 0;
          return d1.name==d2.source.name ? 1 : 0.1; }); 

      svg.selectAll(".linksP2")  
        .transition().duration(dur)
        .attr("stroke-opacity", function (d2){ 
          if (!document.getElementById("checkboxP1").checked) return 0;
          return d1.name==d2.source.name ? 1 : 0.1; }); 
      svg.selectAll(".linksP3")  
        .transition().duration(dur)
        .attr("stroke-opacity", function (d2){ 
          if (!document.getElementById("checkboxP1").checked) return 0;
          return d1.name==d2.source.name ? 1 : 0.1; });   
      svg.selectAll(".links02")  
        .transition().duration(dur)
        .attr("stroke-opacity", function (d2){ 
          if (!document.getElementById("checkboxP1").checked) return 0;
          return d1.name==d2.source.name ? 1 : 0.1; });
       svg.selectAll(".links03")  
        .transition().duration(dur)
        .attr("stroke-opacity", function (d2){ 
          if (!document.getElementById("checkboxP1").checked) return 0;
          return d1.name==d2.source.name ? 1 : 0.1; });            

      if (document.getElementById("checkboxP1").checked){
        textP1(d1.index);
      }  
      textContribution(d1.index);       
    }

  function textContribution(index){
      svg.append("text")
        .attr("class", "textContribution")
        .style("font-size", "13px")
        .attr("text-anchor", "left")
        .style("text-shadow", "1px 1px 0 rgba(200, 200, 200, 0.9")
        .attr("fill", "#000")
        .attr("x", radius+nodes[index].x+5)
        .attr("y", nodes[index].y+3)
        .text("Participation: "+nodes[index].score+"%");

       if (nodes[index].studentTalk>0){
        svg.append("text")
            .attr("class", "textStudentTalk")
            .style("font-size", "13px")
            .attr("text-anchor", "left")
            .style("text-shadow", "1px 1px 0 rgba(200, 200, 200, 0.9")
            .attr("fill", "#000")
            .attr("x", radius+nodes[index].x+5)
            .attr("y", nodes[index].y+20)
            .text("SC Talk: "+nodes[index].studentTalk+"%");
       }
       else{
         svg.append("text")
             .attr("class", "textStudentTalk")
             .style("font-size", "13px")
             .attr("text-anchor", "left")
             .style("text-shadow", "1px 1px 0 rgba(200, 200, 200, 0.9")
             .attr("fill", "#00f")
             .attr("x", radius+nodes[index].x+5)
             .attr("y", nodes[index].y+20)
             .text("SC Talk: not yet presented");

       }
        if (nodes[index].studentReport>=0){
            svg.append("text")
                .attr("class", "textStudentReport")
                .style("font-size", "13px")
                .attr("text-anchor", "left")
                .style("text-shadow", "1px 1px 0 rgba(200, 200, 200, 0.9")
                .attr("fill", "#000")
                .attr("x", radius+nodes[index].x+5)
                .attr("y", nodes[index].y+35)
                .text("SC Report: "+nodes[index].studentReport+"%");
        }
    }  

    function mouseoutNode(d1){
      svg.selectAll(".lineGraph")
        .transition().duration(dur)
        .attr("stroke-opacity", 1);
      svg.selectAll(".nodeImage")
        .transition().duration(dur)
        .attr("stroke-opacity", 1)
        .attr("fill-opacity", 1); ;  
      svg.selectAll(".nodeCircle")
        .transition().duration(dur)
        .attr("stroke-opacity", 1)
        .attr("fill-opacity", 1); 

      
      svg.selectAll(".links")  
        .transition().duration(dur)
        .attr("stroke-opacity", 1);
      if (document.getElementById("checkboxP1").checked){
        svg.selectAll(".linksP1")  
          .transition().duration(dur)
          .attr("stroke-opacity", 1);
        svg.selectAll(".linksP2")  
          .transition().duration(dur)
          .attr("stroke-opacity", 1);
        svg.selectAll(".linksP3")  
          .transition().duration(dur)
          .attr("stroke-opacity", 1); 

        svg.selectAll(".nodeImageP1") 
          .transition().duration(400)
          .attr("fill-opacity",function(d){ 
            return (d.name.indexOf("Manasa")<0 && d.name.indexOf("Paul")<0)? 1 : 0;})
          .attr("stroke-opacity",function(d){ 
            return (d.name.indexOf("Manasa")<0 && d.name.indexOf("Paul")<0)? 1 : 0;});  
        svg.selectAll(".links01")
          .transition().duration(400)
          .attr("stroke-opacity",function(d){ 
            return (d.source.name.indexOf("Manasa")<0 && d.source.name.indexOf("Paul")<0)? 1 : 0;
          });    
        svg.selectAll(".links02")
          .transition().duration(400)
          .attr("stroke-opacity",function(d){ 
            return (d.source.name.indexOf("Manasa")<0 && d.source.name.indexOf("Paul")<0)? 1 : 0;
          });  
        svg.selectAll(".links03")
          .transition().duration(400)
          .attr("stroke-opacity",function(d){ 
            return (d.source.name.indexOf("Manasa")<0 && d.source.name.indexOf("Paul")<0)? 1 : 0;
          });             
      }  
    }

function mouseoverLegend(d1){
      svg.selectAll(".legendText")
          .attr("fill-opacity", function (d2){
           return d1.program==d2.program ? 1 : 0.1; });
        svg.selectAll(".legendLine")
          .attr("stroke-opacity", function (d2){
           return d1.program==d2.program ? 1 : 0.1; });
        svg.selectAll(".legendCircle")
          .attr("fill-opacity", function (d2){
           return d1.program==d2.program ? 1 : 0.1; });
        svg.selectAll(".lineGraph")
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){
           return getCategoty(d1.program)==d2.group ? 1 : 0.05; });
        svg.selectAll(".nodeImage")
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ 
            return getCategoty(d1.program)==d2.group ? 1 : 0.05; })
          .attr("fill-opacity", function (d2){ 
            return getCategoty(d1.program)==d2.group ? 1 : 0.1; });   
        svg.selectAll(".nodeImageP1")
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ 
            if (!document.getElementById("checkboxP1").checked) return 0;
            return getCategoty(d1.program)==d2.group ? 1 : 0.05; })
          .attr("fill-opacity", function (d2){ 
            if (!document.getElementById("checkboxP1").checked) return 0;
            return getCategoty(d1.program)==d2.group ? 1 : 0.1; });   
        svg.selectAll(".nodeCircle")  
          .transition().duration(dur)
          .attr("fill-opacity", function (d2){ 
            return getCategoty(d1.program)==d2.group ? 1 : 0.1; });   
        
        svg.selectAll(".links")  
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ return getCategoty(d1.program)==d2.source.group ? 1 : 0.1; });
        svg.selectAll(".linksP1")  
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ return getCategoty(d1.program)==d2.source.group ? 1 : 0.1; });
        svg.selectAll(".links01")
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ return getCategoty(d1.program)==d2.source.group ? 1 : 0.1; });
        svg.selectAll(".linksP2")  
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ return getCategoty(d1.program)==d2.source.group ? 1 : 0.1; });
        svg.selectAll(".links02")
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ return getCategoty(d1.program)==d2.source.group ? 1 : 0.1; });
        svg.selectAll(".linksP3")  
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ return getCategoty(d1.program)==d2.source.group ? 1 : 0.1; });
        svg.selectAll(".links03")
          .transition().duration(dur)
          .attr("stroke-opacity", function (d2){ return getCategoty(d1.program)==d2.source.group ? 1 : 0.1; });    
     
    }  
    function mouseoutLegend(d1){
      svg.selectAll(".legendText")
          .attr("fill-opacity", 1);
        svg.selectAll(".legendLine")
          .attr("stroke-opacity", 1);
        svg.selectAll(".legendCircle")
          .attr("fill-opacity", 1);
        svg.selectAll(".lineGraph")
          .transition().duration(dur)
          .attr("stroke-opacity", 1);
        svg.selectAll(".nodeImage")
          .transition().duration(dur)
          .attr("stroke-opacity", 1)
          .attr("fill-opacity", 1);   
        svg.selectAll(".links")  
          .transition().duration(dur)
          .attr("stroke-opacity", 1); 
        svg.selectAll(".nodeCircle")  
          .transition().duration(dur)
          .attr("fill-opacity", 1);  
          
    }  

function dragstarted(d) {
  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}

function dragged(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}

function dragended(d) {
  if (!d3.event.active) simulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}

</script>
</body>